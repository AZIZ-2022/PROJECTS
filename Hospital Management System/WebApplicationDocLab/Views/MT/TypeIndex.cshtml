@model IEnumerable<WebApplicationDocLab.Models.Doctor_Type>

@{
    ViewBag.Title = "TypeIndex";
    Layout = "~/Views/_LayoutPageAdminIndex.cshtml";
}

<div class="container mt-4">
    <h2 class="mb-4 text-center fw-bold">Doctor Types</h2>

    <div class="d-flex justify-content-between mb-3">
        @Html.ActionLink("Create New", "TypeCreate", null, new { @class = "btn btn-success shadow-sm rounded-pill" })
        <input type="text" id="searchInput" class="form-control w-25 shadow-sm" placeholder="Search types..." />
    </div>

    <table class="table table-hover table-bordered table-striped shadow-sm rounded" id="doctorTypesTable">
        <thead class="table-dark">
            <tr>
                <th width="80px" class="text-center">Sl No</th>
                <th>Type Name</th>
                <th width="220px" class="text-center">Actions</th>
            </tr>
        </thead>
        <tbody>
            @{ int slNo = 1; }
            @foreach (var item in Model)
            {
                <tr>
                    <td class="text-center align-middle">@(slNo++)</td>
                    <td class="align-middle">@Html.DisplayFor(modelItem => item.TypeName)</td>
                    <td class="text-center align-middle">
                        @Html.ActionLink("Edit", "TypeEdit", new { id = item.Id }, new { @class = "btn btn-warning btn-sm me-2 rounded-pill shadow-sm" })
                        @using (Html.BeginForm("TypeDeleteConfirmed", "MT", FormMethod.Post, new { onsubmit = "return confirm('Are you sure you want to delete this type?');", @class = "d-inline" }))
                        {
                            @Html.AntiForgeryToken()
                            @Html.Hidden("id", item.Id)
                            <button type="submit" class="btn btn-danger btn-sm rounded-pill shadow-sm">Delete</button>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<script>
    $(document).ready(function () {
        $("#searchInput").on("keyup", function () {
            var searchValue = $(this).val();

            $.ajax({
                url: 'http://localhost:64303/api/SearchType/' + searchValue,
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    var tableBody = $("#doctorTypesTable tbody");
                    tableBody.empty();

                    if (data.length === 0) {
                        tableBody.append('<tr><td colspan="3" class="text-center">No doctor types found</td></tr>');
                    } else {
                        $.each(data, function (index, item) {
                            var row = '<tr>' +
                                '<td class="text-center align-middle">' + (index + 1) + '</td>' +
                                '<td class="align-middle">' + item.TypeName + '</td>' +
                                '<td class="text-center align-middle">' +
                                '<a href="/MT/TypeEdit/' + item.Id + '" class="btn btn-warning btn-sm me-2 rounded-pill shadow-sm">Edit</a>' +
                                '<form action="/MT/TypeDeleteConfirmed" method="post" style="display:inline;" onsubmit="return confirm(\'Are you sure you want to delete this type?\');">' +
                                '<input type="hidden" name="id" value="' + item.Id + '" />' +
                                '<button type="submit" class="btn btn-danger btn-sm rounded-pill shadow-sm">Delete</button>' +
                                '</form>' +
                                '</td>' +
                                '</tr>';
                            tableBody.append(row);
                        });
                    }
                },
                error: function () {
                    alert('Error retrieving data.');
                }
            });
        });
    });

    // Helper function to get AntiForgeryToken (you can replace it with server-side injection if needed)
    function AntiForgeryTokenValue() {
        return $('input[name="__RequestVerificationToken"]').first().val();
    }
</script>
